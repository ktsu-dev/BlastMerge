<!-- Generated by SpecStory -->

# Fix unreachable code in whitespace condition (2025-06-06 08:55:15)

_**User**_


		else if (showWhitespace)
Change this condition so that it does not always evaluate to 'True'. Some code paths are unreachable.

		{
			return MakeWhitespaceVisible(line);
		}

---

_**Assistant**_



---

I'll help you fix the condition that's always evaluating to 'True'. Let me first search for this code in your project.

---

<details>
            <summary>Grep search for "else if \(showWhitespace\)" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///c%3A/dev/ktsu-dev/BlastMerge/BlastMerge.Core/Services/WhitespaceVisualizer.cs` | L153 | `else if (showWhitespace)` |
| `file:///c%3A/dev/ktsu-dev/BlastMerge/.specstory/history/2025-06-05_15-05-compare-diffs-in-iterative-merge-feature.md` | L5128 | `+ 		else if (showWhitespace)` |

</details>

---

Now let me examine the actual code file to understand the context and see what the issue is:

---

Read file: BlastMerge.Core/Services/WhitespaceVisualizer.cs

---

I can see the issue! Looking at the `ProcessLineForDisplay` method, the problem is with the logic flow:

1. Line 109: `if (!showWhitespace && !highlightTrailing)` - returns early if both are false
2. Line 113: `if (highlightTrailing)` - handles the case when `highlightTrailing` is true
3. Line 153: `else if (showWhitespace)` - this will always be true at this point

The issue is that if we reach line 153, it means:
- We didn't return early (so at least one of `showWhitespace` or `highlightTrailing` is true)
- `highlightTrailing` is false (because of the else if)
- Therefore `showWhitespace` must be true

The condition should just be `else` since we know `showWhitespace` must be true at that point, or we need to restructure the logic. Let me fix this:

---



---

Let me fix this properly. The issue is that the `else if (showWhitespace)` condition is redundant because at that point, `showWhitespace` must be true. Let me change it to just `else`:

---



---

I see there's still an unreachable code issue. Let me analyze the logic more carefully. The problem is that after the `if (!showWhitespace && !highlightTrailing)` early return, we have two cases to handle:

1. `highlightTrailing` is true (which may or may not include `showWhitespace`)
2. `highlightTrailing` is false and `showWhitespace` is true

But there's also a case where both are true that's already handled in the first if block. Let me fix this by restructuring the logic properly:

---



---

Perfect! I've fixed the issue by removing the problematic `else if (showWhitespace)` condition. Here's what I changed:

1. **Removed the redundant `else if (showWhitespace)` condition** - At that point in the code, if we haven't returned early and `highlightTrailing` is false, then `showWhitespace` must be true (since we already handled the case where both are false).

2. **Replaced it with a direct return statement** - Since we know `showWhitespace` must be true when we reach that point, we can directly call `MakeWhitespaceVisible(line)`.

3. **Added a clarifying comment** - To explain why we can assume `showWhitespace` is true at that point.

4. **Removed the unreachable `return line;`** - This was dead code that could never be reached.

The logic now flows correctly:
- If both `showWhitespace` and `highlightTrailing` are false → return original line
- If `highlightTrailing` is true → handle highlighting (with optional whitespace visualization)  
- Otherwise → `highlightTrailing` is false and `showWhitespace` must be true → show whitespace

This eliminates the "always true" condition and removes the unreachable code paths.

---

