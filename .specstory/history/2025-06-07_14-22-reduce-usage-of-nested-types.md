<!-- Generated by SpecStory -->

# Reduce usage of nested types (2025-06-08 00:22:32)

_**User**_

reduce the usage of nested types

---

_**Assistant**_



---

I'll help you reduce the usage of nested types in your BlastMerge project. Let me first explore the codebase to identify where nested types are currently being used.

---

<details>
            <summary>Searched codebase "nested types class interface struct" • **19** results</summary>
        
| File | Lines |
|------|-------|
| `BlastMerge.Core/Models/BlockType.cs` | L1-27 |
| `BlastMerge.Core/Models/LineDifferenceType.cs` | L1-28 |
| `.editorconfig` | L304-344 |
| `.editorconfig` | L264-304 |
| `.editorconfig` | L229-264 |
| `BlastMerge.Core/Models/LineDifference.cs` | L1-17 |
| `.editorconfig` | L344-384 |
| `BlastMerge.Core/Models/ResolutionItem.cs` | L1-70 |
| `BlastMerge.ConsoleApp/ICommandLineHandler.cs` | L1-19 |
| `BlastMerge.Core/Models/MergeSessionStatus.cs` | L1-15 |
| `BlastMerge.Core/Models/DirectoryComparisonResult.cs` | L1-35 |
| `BlastMerge.Core/Models/DiffBlock.cs` | L1-44 |
| `BlastMerge.Core/Models/FileGroup.cs` | L1-44 |
| `BlastMerge.Core/Contracts/IApplicationService.cs` | L1-53 |
| `BlastMerge.Core/Models/MergeCompletionResult.cs` | L1-36 |
| `BlastMerge.ConsoleApp/Contracts/IMenuHandler.cs` | L1-17 |
| `BlastMerge.Core/Models/BlockContext.cs` | L1-34 |
| `BlastMerge.Core/Models/MergeOperationSummary.cs` | L1-47 |
| `BlastMerge.Core/Models/MergeResult.cs` | L1-23 |

</details>

---

Now let me search more specifically for nested types - classes, interfaces, structs, or enums defined inside other types:

---

<details>
            <summary>Grep search for "class.*\{.*\n.*class|interface.*\{.*\n.*interface|struct.*\{.*\n.*struct|enum.*\{.*\n.*enum" • **0** files</summary>
        
No results found
</details>

---

Let me try a different approach to find nested types:

---

<details>
            <summary>Grep search for "public class.*\{[\s\S]*?public.*class|public interface.*\{[\s\S]*?public.*interface|public struct.*\{[\s\S]*?public.*struct|public enum.*\{[\s\S]*?public.*enum" • **0** files</summary>
        
No results found
</details>

---

Let me search for indented nested types more directly:

---

<details>
            <summary>Grep search for "\n\s+public (class|interface|struct|enum)" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///c%3A/dev/ktsu-dev/BlastMerge/BlastMerge.Test/MockFileSystemTests.cs` | L149 | `}

public interface IFileHasher` |
| `file:///c%3A/dev/ktsu-dev/BlastMerge/BlastMerge.Test/MockFileSystemTests.cs` | L154 | `}

public interface IFileDiffer` |
| `file:///c%3A/dev/ktsu-dev/BlastMerge/BlastMerge.Core/Models/BlastMergeAppData.cs` | L37 | `/// </summary>
	public class RecentBatchInfo` |
| `file:///c%3A/dev/ktsu-dev/BlastMerge/BlastMerge.Core/Models/BlastMergeAppData.cs` | L53 | `/// </summary>
	public class ApplicationSettings` |

</details>

---

Great! I found some nested types. Let me examine these files more closely:

---

Read file: BlastMerge.Test/MockFileSystemTests.cs

---

Read file: BlastMerge.Core/Models/BlastMergeAppData.cs

---

Let me also check for any other patterns that might indicate nested types:

---

<details>
            <summary>Grep search for "\n\s+internal (class|interface|struct|enum)" • **0** files</summary>
        
No results found
</details>

---

<details>
            <summary>Grep search for "\n\s+private (class|interface|struct|enum)" • **3** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///c%3A/dev/ktsu-dev/BlastMerge/BlastMerge.ConsoleApp/Services/SyncOperationsService.cs` | L331 | `/// </summary>
	private enum SyncChoice` |
| `file:///c%3A/dev/ktsu-dev/BlastMerge/BlastMerge.ConsoleApp/Services/MenuHandlers/SettingsMenuHandler.cs` | L197 | `/// </summary>
	private enum SettingsChoice` |
| `file:///c%3A/dev/ktsu-dev/BlastMerge/BlastMerge.ConsoleApp/Services/MenuHandlers/HelpMenuHandler.cs` | L170 | `/// </summary>
	private enum HelpChoice` |

</details>

---

Perfect! Now I have a comprehensive view of the nested types in the codebase. Let me examine these files to understand the nested types better:

---

Read file: BlastMerge.ConsoleApp/Services/SyncOperationsService.cs

---

Read file: BlastMerge.ConsoleApp/Services/MenuHandlers/SettingsMenuHandler.cs

---

Read file: BlastMerge.ConsoleApp/Services/MenuHandlers/HelpMenuHandler.cs

---

Now I have a complete understanding of the nested types in the codebase. Let me also check if there are any more nested types I might have missed:

---

<details>
            <summary>Grep search for "\n\s+protected (class|interface|struct|enum)" • **0** files</summary>
        
No results found
</details>

---

Based on my analysis, I found the following nested types in your BlastMerge project:

## Current Nested Types

1. **BlastMergeAppData.cs** - 2 nested public classes:
   - `RecentBatchInfo` class
   - `ApplicationSettings` class

2. **SyncOperationsService.cs** - 1 nested private enum:
   - `SyncChoice` enum

3. **SettingsMenuHandler.cs** - 1 nested private enum:
   - `SettingsChoice` enum

4. **HelpMenuHandler.cs** - 1 nested private enum:
   - `HelpChoice` enum

5. **MockFileSystemTests.cs** - 3 nested public interfaces (for testing):
   - `IFileFinder` interface
   - `IFileHasher` interface  
   - `IFileDiffer` interface

Now let me refactor these nested types to reduce nesting:

---

```diff
- 
+ // Copyright (c) ktsu.dev
+ // All rights reserved.
+ // Licensed under the MIT license.
+ 
+ namespace ktsu.BlastMerge.Core.Models;
+ 
+ using System;
+ 
+ /// <summary>
+ /// Represents information about the most recently used batch configuration.
+ /// </summary>
+ public class RecentBatchInfo
+ {
+ 	/// <summary>
+ 	/// Gets or sets the name of the most recent batch.
+ 	/// </summary>
+ 	public string BatchName { get; set; } = string.Empty;
+ 
+ 	/// <summary>
+ 	/// Gets or sets when the batch was last used.
+ 	/// </summary>
+ 	public DateTime LastUsed { get; set; }
+ } 
```

---

```diff
- 
+ // Copyright (c) ktsu.dev
+ // All rights reserved.
+ // Licensed under the MIT license.
+ 
+ namespace ktsu.BlastMerge.Core.Models;
+ 
+ /// <summary>
+ /// Represents application-wide settings and preferences.
+ /// </summary>
+ public class ApplicationSettings
+ {
+ 	/// <summary>
+ 	/// Gets or sets the maximum number of history entries to keep per prompt type.
+ 	/// </summary>
+ 	public int MaxHistoryEntriesPerPrompt { get; set; } = 50;
+ 
+ 	/// <summary>
+ 	/// Gets or sets whether to automatically save configuration changes.
+ 	/// </summary>
+ 	public bool AutoSaveEnabled { get; set; } = true;
+ 
+ 	/// <summary>
+ 	/// Gets or sets the last configuration schema version.
+ 	/// </summary>
+ 	public string ConfigurationVersion { get; set; } = "1.0.0";
+ } 
```

---

```diff
- 
+ // Copyright (c) ktsu.dev
+ // All rights reserved.
+ // Licensed under the MIT license.
+ 
+ namespace ktsu.BlastMerge.ConsoleApp.Contracts;
+ 
+ /// <summary>
+ /// Sync operation choices.
+ /// </summary>
+ internal enum SyncChoice
+ {
+ 	/// <summary>
+ 	/// Synchronize to the newest version.
+ 	/// </summary>
+ 	SyncToNewest,
+ 
+ 	/// <summary>
+ 	/// Choose a reference file manually.
+ 	/// </summary>
+ 	ChooseReference,
+ 
+ 	/// <summary>
+ 	/// Go back to previous menu.
+ 	/// </summary>
+ 	Back
+ } 
```

---

```diff
- 
+ // Copyright (c) ktsu.dev
+ // All rights reserved.
+ // Licensed under the MIT license.
+ 
+ namespace ktsu.BlastMerge.ConsoleApp.Contracts;
+ 
+ /// <summary>
+ /// Settings menu choices.
+ /// </summary>
+ internal enum SettingsChoice
+ {
+ 	/// <summary>
+ 	/// View configuration paths.
+ 	/// </summary>
+ 	ViewConfigurationPaths,
+ 
+ 	/// <summary>
+ 	/// Clear input history.
+ 	/// </summary>
+ 	ClearInputHistory,
+ 
+ 	/// <summary>
+ 	/// View application statistics.
+ 	/// </summary>
+ 	ViewStatistics,
+ 
+ 	/// <summary>
+ 	/// Go back to main menu.
+ 	/// </summary>
+ 	BackToMainMenu
+ } 
```

---

```diff
- 
+ // Copyright (c) ktsu.dev
+ // All rights reserved.
+ // Licensed under the MIT license.
+ 
+ namespace ktsu.BlastMerge.ConsoleApp.Contracts;
+ 
+ /// <summary>
+ /// Help menu choices.
+ /// </summary>
+ internal enum HelpChoice
+ {
+ 	/// <summary>
+ 	/// Show application overview.
+ 	/// </summary>
+ 	ApplicationOverview,
+ 
+ 	/// <summary>
+ 	/// Show feature guide.
+ 	/// </summary>
+ 	FeatureGuide,
+ 
+ 	/// <summary>
+ 	/// Show keyboard shortcuts.
+ 	/// </summary>
+ 	KeyboardShortcuts,
+ 
+ 	/// <summary>
+ 	/// Go back to main menu.
+ 	/// </summary>
+ 	BackToMainMenu
+ } 
```

---

Now for the test interfaces, I'll create separate files in the Test project:

---

```diff
- 
+ // Copyright (c) ktsu.dev
+ // All rights reserved.
+ // Licensed under the MIT license.
+ 
+ namespace ktsu.BlastMerge.Test.Adapters;
+ 
+ using System.Collections.ObjectModel;
+ 
+ /// <summary>
+ /// Interface for file finding operations to support mocking.
+ /// </summary>
+ public interface IFileFinder
+ {
+ 	/// <summary>
+ 	/// Finds files matching the specified pattern in the given directory.
+ 	/// </summary>
+ 	/// <param name="directoryPath">The directory path to search.</param>
+ 	/// <param name="searchPattern">The search pattern for files.</param>
+ 	/// <returns>A read-only collection of file paths.</returns>
+ 	public ReadOnlyCollection<string> FindFiles(string directoryPath, string searchPattern);
+ } 
```

---

```diff
- 
+ // Copyright (c) ktsu.dev
+ // All rights reserved.
+ // Licensed under the MIT license.
+ 
+ namespace ktsu.BlastMerge.Test.Adapters;
+ 
+ /// <summary>
+ /// Interface for file hashing operations to support mocking.
+ /// </summary>
+ public interface IFileHasher
+ {
+ 	/// <summary>
+ 	/// Computes a hash for the specified file.
+ 	/// </summary>
+ 	/// <param name="filePath">The path to the file to hash.</param>
+ 	/// <returns>The computed hash as a string.</returns>
+ 	public string ComputeFileHash(string filePath);
+ } 
```

---

```diff
- 
+ // Copyright (c) ktsu.dev
+ // All rights reserved.
+ // Licensed under the MIT license.
+ 
+ namespace ktsu.BlastMerge.Test.Adapters;
+ 
+ using System.Collections.ObjectModel;
+ 
+ /// <summary>
+ /// Interface for file diffing operations to support mocking.
+ /// </summary>
+ public interface IFileDiffer
+ {
+ 	/// <summary>
+ 	/// Finds differences between two files.
+ 	/// </summary>
+ 	/// <param name="file1Path">The path to the first file.</param>
+ 	/// <param name="file2Path">The path to the second file.</param>
+ 	/// <returns>A read-only collection of difference strings.</returns>
+ 	public ReadOnlyCollection<string> FindDifferences(string file1Path, string file2Path);
+ 
+ 	/// <summary>
+ 	/// Generates a Git-style diff between two files.
+ 	/// </summary>
+ 	/// <param name="file1Path">The path to the first file.</param>
+ 	/// <param name="file2Path">The path to the second file.</param>
+ 	/// <returns>A Git-style diff as a string.</returns>
+ 	public string GenerateGitStyleDiff(string file1Path, string file2Path);
+ } 
```

---

Now I need to update the original files to remove the nested types and use the new standalone types:

---



---



---



---



---

I need to add the using statement for the moved SyncChoice enum and fix the formatting:

---



---

Read file: BlastMerge.ConsoleApp/Services/SyncOperationsService.cs

---





---



---



---

Now let me update the SettingsMenuHandler:

---



---



---

I also need to add the using statement for SettingsChoice:

---

Read file: BlastMerge.ConsoleApp/Services/MenuHandlers/SettingsMenuHandler.cs

---



---

