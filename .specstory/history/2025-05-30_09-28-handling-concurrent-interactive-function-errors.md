<!-- Generated by SpecStory -->

# Handling concurrent interactive function errors (2025-05-30 19:28:46)

_**User**_

System.InvalidOperationException
  HResult=0x80131509
  Message=Trying to run one or more interactive functions concurrently. Operations with dynamic displays (e.g. a prompt and a progress display) cannot be running at the same time.
  Source=Spectre.Console
  StackTrace:
   at Spectre.Console.Internal.DefaultExclusivityMode.<RunAsync>d__3`1.MoveNext() in /_/src/Spectre.Console/Internal/DefaultExclusivityMode.cs:line 35
   at Spectre.Console.TextPrompt`1.<ShowAsync>d__63.MoveNext() in /_/src/Spectre.Console/Prompts/TextPrompt.cs:line 122
   at Spectre.Console.ConfirmationPrompt.<ShowAsync>d__39.MoveNext() in /_/src/Spectre.Console/Prompts/ConfirmationPrompt.cs:line 92
   at Spectre.Console.ConfirmationPrompt.Show(IAnsiConsole console) in /_/src/Spectre.Console/Prompts/ConfirmationPrompt.cs:line 73
   at Spectre.Console.AnsiConsole.Confirm(String prompt, Boolean defaultValue) in /_/src/Spectre.Console/AnsiConsole.Prompt.cs:line 103
   at ktsu.DiffMore.CLI.Program.<>c__DisplayClass17_0.<CompareDirectories>b__0(StatusContext ctx) in C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs:line 676
   at Spectre.Console.Status.<>c__DisplayClass14_0.<Start>b__0(StatusContext ctx) in /_/src/Spectre.Console/Live/Status/Status.cs:line 44
   at Spectre.Console.Status.<>c__DisplayClass16_0.<<StartAsync>b__0>d.MoveNext() in /_/src/Spectre.Console/Live/Status/Status.cs:line 79
   at Spectre.Console.Status.<>c__DisplayClass17_0`1.<<StartAsync>b__0>d.MoveNext() in /_/src/Spectre.Console/Live/Status/Status.cs:line 120
   at Spectre.Console.Progress.<>c__DisplayClass32_0`1.<<StartAsync>b__0>d.MoveNext() in /_/src/Spectre.Console/Live/Progress/Progress.cs:line 138
   at Spectre.Console.Internal.DefaultExclusivityMode.<RunAsync>d__3`1.MoveNext() in /_/src/Spectre.Console/Internal/DefaultExclusivityMode.cs:line 46
   at Spectre.Console.Progress.<StartAsync>d__32`1.MoveNext() in /_/src/Spectre.Console/Live/Progress/Progress.cs:line 121
   at Spectre.Console.Status.<StartAsync>d__17`1.MoveNext() in /_/src/Spectre.Console/Live/Status/Status.cs:line 117
   at Spectre.Console.Status.<StartAsync>d__16.MoveNext() in /_/src/Spectre.Console/Live/Status/Status.cs:line 77
   at Spectre.Console.Status.Start(String status, Action`1 action) in /_/src/Spectre.Console/Live/Status/Status.cs:line 48
   at ktsu.DiffMore.CLI.Program.CompareDirectories(String dir1, String dir2, String pattern, Boolean recursive) in C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs:line 634
   at ktsu.DiffMore.CLI.Program.CompareTwoDirectories() in C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs:line 171
   at ktsu.DiffMore.CLI.Program.RunInteractiveMode() in C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs:line 102
   at ktsu.DiffMore.CLI.Program.Main(String[] args) in C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs:line 48


---

_**Assistant**_



---

I can see you're experiencing a Spectre.Console concurrency issue. The error occurs because you're trying to show an interactive prompt (`AnsiConsole.Confirm`) while a status display is running, which isn't allowed in Spectre.Console.

Let me examine the code to understand the structure and fix this issue.

---

Read file: DiffMore.ConsoleApp/Program.cs

---

Now let me see more of the code to understand the full context, particularly the `CompareDirectories` method where the error occurs:

---

Read file: DiffMore.ConsoleApp/Program.cs

---

Perfect! I can see the issue now. In the `CompareDirectories` method, there's an `AnsiConsole.Confirm` call on line 676 that's happening inside an `AnsiConsole.Status().Start()` context. This is not allowed in Spectre.Console because you can't run interactive functions while a status display is active.

The same problem exists in the `CompareTwoFiles` method where there's an `AnsiConsole.Prompt` call inside a status context.

Let me fix this by restructuring the code to separate the status display from the interactive prompts:

---

```diff
  	/// Compares two directories
  	/// </summary>
+ 	/// <param name="dir1">First directory path</param>
+ 	/// <param name="dir2">Second directory path</param>
+ 	/// <param name="pattern">File search pattern</param>
+ 	/// <param name="recursive">Whether to search recursively</param>
  	private static void CompareTwoDirectories()
  	{
```

```diff
  	private static void CompareDirectories(string dir1, string dir2, string pattern, bool recursive)
  	{
+ 		DirectoryComparisonResult result = null;
+ 		
  		AnsiConsole.Status()
  			.Spinner(Spinner.Known.Star)
  			.Start($"[yellow]Comparing directories...[/]", ctx =>
  			{
- 				var result = FileDiffer.FindDifferences(dir1, dir2, pattern, recursive);
- 
+ 				result = FileDiffer.FindDifferences(dir1, dir2, pattern, recursive);
  				ctx.Status("[yellow]Creating comparison report...[/]");
+ 			});
  
- 				// Display results
+ 		// Display results (outside the status context)
  		var table = new Table()
  			.AddColumn("[bold]Category[/]")
```

```diff
  		AnsiConsole.Write(table);
  
- 				// Show detailed differences for modified files if requested
+ 		// Show detailed differences for modified files if requested (outside status context)
  		if (result.ModifiedFiles.Count > 0 &&
  			AnsiConsole.Confirm("[cyan]Show detailed differences for modified files?[/]", false))
```

```diff
  			}
  		}
- 			});
  	}
  
```

---

Now let me fix the same issue in the `CompareTwoFiles` method:

---

```diff
  	private static void CompareTwoFiles(string file1, string file2)
  	{
+ 		bool areSame = false;
+ 		
  		AnsiConsole.Status()
  			.Spinner(Spinner.Known.Star)
  			.Start("[yellow]Comparing files...[/]", ctx =>
  			{
- 				var areSame = DiffPlexDiffer.AreFilesIdentical(file1, file2);
+ 				areSame = DiffPlexDiffer.AreFilesIdentical(file1, file2);
+ 			});
  
  		if (areSame)
```

```diff
  			ShowColoredDiff(file1, file2);
  		}
- 			});
  	}
  
```

---

Now let me check if there are any other places in the code where similar issues might occur. Let me look for other uses of interactive functions within status contexts:

---

<details>
            <summary>Grep search for "AnsiConsole\.(Confirm|Prompt).*Status" • **0** files</summary>
        
No results found
</details>

---

Let me also check for Status blocks that contain interactive functions:

---

<details>
            <summary>Grep search for "Status\(\).*Start.*AnsiConsole\.(Confirm|Prompt)" • **0** files</summary>
        
No results found
</details>

---

Let me search for any remaining patterns where Status and interactive functions might conflict:

---

<details>
            <summary>Grep search for "\.Start\(.*ctx.*=>" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L247 | `.Start($"[yellow]Searching for '{fileName}' in '{directory}'...[/]", ctx =>` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L641 | `.Start($"[yellow]Comparing directories...[/]", ctx =>` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L712 | `.Start("[yellow]Comparing files...[/]", ctx =>` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L813 | `.Start(ctx =>` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L247 | `.Start($"[yellow]Searching for '{fileName}' in '{directory}'...[/]", ctx =>` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L641 | `.Start($"[yellow]Comparing directories...[/]", ctx =>` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L712 | `.Start("[yellow]Comparing files...[/]", ctx =>` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L813 | `.Start(ctx =>` |

</details>

---

Let me check the other Status.Start blocks to see if they have similar issues:

---

Read file: DiffMore.ConsoleApp/Program.cs

---

Let me check the `OfferSyncOptions` method around line 813:

---

Read file: DiffMore.ConsoleApp/Program.cs

---

Good! The code looks fine in the `ProcessFiles` method around line 247 - it doesn't contain any interactive functions within the Status block. The `OfferSyncOptions` method around line 813 uses Progress, not Status, and also doesn't have interactive functions within it.

Let me now test the fixes by building the project to see if there are any compilation errors:

---

```bash
cd "c:\dev\ktsu-dev\DiffMore" && dotnet build
```

```
 PS C:\dev\ktsu-dev\DiffMore >
  09:30:27   DiffMore 
  19:30:27 main  ?1 ~1
 PS C:\dev\ktsu-dev\DiffMore >


























  09:30:28   DiffMore  
  19:30:28 main  ?1 ~1 
 PS C:\dev\ktsu-dev\DiffMore >
```

---

It seems like the build completed but didn't show output. Let me try again with verbose output to see if there are any issues:

---

```bash
dotnet build --verbosity normal
```

```
 PS C:\dev\ktsu-dev\DiffMore >dotnet test --verbosity normal --filter "FileDiffer_EmptyFil
 PS C:\dev\ktsu-dev\DiffMore >dotnet build --verbosity normal --configuration Debug --prop
erty WarningsAsErrors=
Oops, something went wrong.
Please report this bug with ALL the details below, including both the 'Environment' and 'E
xception' sections.
Please report on GitHub: https://github.com/PowerShell/PSReadLine/issues/new?template=Bug_
Report.yaml
Thank you!

### Environment
PSReadLine: 2.3.6+d2e770f93b7a53d8660a6402eb29d1ae1c35e767
PowerShell: 7.5.1
OS: Microsoft Windows 10.0.26100
BufferWidth: 90
BufferHeight: 1

Last 200 Keys:

 d s o n \ A p p D a t a \ L o c a l \ P r o g r a m s \ c u r s o r \ r e s o u r c e s \
 a p p \ o u t \ v s \ w o r k b e n c h \ c o n t r i b \ t e r m i n a l \ c o m m o n \
 s c r i p t s \ s h e l l I n t e g r a t i o n . p s 1 " Enter
 Ctrl+l Enter
 c d Spacebar " c : \ d e v \ k t s u - d e v \ D i f f M o r e " Spacebar & & Spacebar d 
o t n e t Spacebar b u i l d Enter
 d o t n e t Spacebar b u i l d Spacebar - - v e r b o s i t y Spacebar n o r m a l Enter 


### Exception

System.IndexOutOfRangeException: Index was outside the bounds of the array.
   at System.Text.StringBuilder.get_Chars(Int32 index)
   at Microsoft.PowerShell.PSConsoleReadLine.ConvertOffsetToPoint(Int32 offset)
   at Microsoft.PowerShell.PSConsoleReadLine.ReallyRender(RenderData renderData, String de
faultColor)
   at Microsoft.PowerShell.PSConsoleReadLine.ForceRender()
   at Microsoft.PowerShell.PSConsoleReadLine.Render()
   at Microsoft.PowerShell.PSConsoleReadLine.Insert(Char c)
   at Microsoft.PowerShell.PSConsoleReadLine.SelfInsert(Nullable`1 key, Object arg)

   at Microsoft.PowerShell.PSConsoleReadLine.ProcessOneKey(PSKeyInfo key, Dictionary`2 dis
patchTable, Boolean ignoreIfNoAction, Object arg)
   at Microsoft.PowerShell.PSConsoleReadLine.InputLoop()
   at Microsoft.PowerShell.PSConsoleReadLine.ReadLine(Runspace runspace, EngineIntrinsics 
engineIntrinsics, CancellationToken cancellationToken, Nullable`1 lastRunStatus)


  09:30:32   DiffMore   1 - ERROR 
  19:30:32 main  ?1 ~1 
 PS C:\dev\ktsu-dev\DiffMore >












```

---

There seems to be an issue with PowerShell. Let me try a simple build command:

---

```bash
dotnet build
```

```
 PS C:\dev\ktsu-dev\DiffMore >dotnet build

  C:\dev\ktsu-dev\DiffMore\DiffMore.sln                                    Restore (0.0s) 
Restore complete (0.7s)
  DiffMore.Core succeeded (0.2s) → DiffMore.Core\bin\Debug\net9.0\ktsu.DiffMore.Core.dll

  DiffMore.ConsoleApp failed with 3 error(s) (0.2s)
    C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs(638,38): error CS8600: Convert
ing null literal or possible null value to non-nullable type.
    C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs(657,13): error CS8602: Derefer
ence of a possibly null reference.
    C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs(709,3): error IDE0007: use 'va
r' instead of explicit type (https://learn.microsoft.com/dotnet/fundamentals/code-analysis
/style-rules/ide0007)

Build failed with 3 error(s) in 1.4s
  09:30:39   DiffMore  1.715s   1 - ERROR 
  19:30:39 main  ?1 ~1 

```

---

Good! Now I can see the compilation errors. I need to fix a few issues with null handling and the use of `var` instead of explicit type. Let me fix these:

---

```diff
  	private static void CompareDirectories(string dir1, string dir2, string pattern, bool recursive)
  	{
- 		DirectoryComparisonResult result = null;
+ 		DirectoryComparisonResult? result = null;
  		
  		AnsiConsole.Status()
```

```diff
  		table.AddRow(
  			"[green]Identical Files[/]",
- 			$"[cyan]{result.SameFiles.Count}[/]",
+ 			$"[cyan]{result!.SameFiles.Count}[/]",
  			string.Join(", ", result.SameFiles.Take(3).Select(Path.GetFileName))
  		);
```

---

Now let me fix the var usage issue:

---

```diff
  	private static void CompareTwoFiles(string file1, string file2)
  	{
- 		bool areSame = false;
+ 		var areSame = false;
  		
  		AnsiConsole.Status()
```

---

Now let me try building again to see if the issues are resolved:

---

```bash
dotnet build
```

```
 PS C:\dev\ktsu-dev\DiffMore >dotnet build

Restore complete (0.5s)
  DiffMore.Core succeeded (0.1s) → DiffMore.Core\bin\Debug\net9.0\ktsu.DiffMore.Core.dll

  DiffMore.ConsoleApp failed with 4 error(s) (0.2s)
    C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs(150,19): error CS1572: XML com
    C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs(152,19): error CS1572: XML com
ment has a param tag for 'pattern', but there is no parameter by that name
    C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs(153,19): error CS1572: XML com
ment has a param tag for 'recursive', but there is no parameter by that name

Build failed with 4 error(s) in 1.1s
  09:31:17   DiffMore  1.413s   1 - ERROR 
  19:31:17 main  ?1 ~1 

```

---

There are XML documentation errors. It looks like the method signature doesn't match the documentation. Let me check and fix this:

---

Read file: DiffMore.ConsoleApp/Program.cs

---

I see the issue. The XML documentation is for `CompareTwoDirectories()` method but it has parameters documented that don't exist in the method signature. Let me fix this:

---

```diff
  	/// <summary>
  	/// Compares files with the same name in a directory
- 	/// </summary>
- 	private static void CompareFilesInDirectory()
- 	{
- 		var directory = HistoryInput.AskWithHistory("[cyan]Enter the directory path:[/]");
- 
- 		if (!Directory.Exists(directory))
- 		{
- 			AnsiConsole.MarkupLine("[red]Error: Directory does not exist![/]");
- 			return;
- 		}
- 
- 		var fileName = HistoryInput.AskWithHistory("[cyan]Enter the filename to search for:[/]");
- 
- 		ProcessFiles(directory, fileName);
- 	}
- 
- 	/// <summary>
- 	/// Compares two directories
- 	/// </summary>
- 	/// <param name="dir1">First directory path</param>
- 	/// <param name="dir2">Second directory path</param>
- 	/// <param name="pattern">File search pattern</param>
- 	/// <param name="recursive">Whether to search recursively</param>
- 	private static void CompareTwoDirectories()
- 	{
- 		var dir1 = HistoryInput.AskWithHistory("[cyan]Enter the first directory path:[/]");
- 
- 		if (!Directory.Exists(dir1))
- 		{
- 			AnsiConsole.MarkupLine("[red]Error: First directory does not exist![/]");
- 			return;
- 		}
- 
- 		var dir2 = HistoryInput.AskWithHistory("[cyan]Enter the second directory path:[/]");
- 
- 		if (!Directory.Exists(dir2))
- 		{
- 			AnsiConsole.MarkupLine("[red]Error: Second directory does not exist![/]");
- 			return;
- 		}
- 
- 		var pattern = HistoryInput.AskWithHistory("[cyan]Enter file pattern (e.g., *.txt, *.cs):[/]", "*.*");
- 		var recursive = AnsiConsole.Confirm("[cyan]Search subdirectories recursively?[/]", false);
- 
- 		CompareDirectories(dir1, dir2, pattern, recursive);
- 	}
- 
- 	/// <summary>
- 	/// Compares two specific files
- 	/// </summary>
- 	private static void CompareTwoSpecificFiles()
- 	{
- 		var file1 = HistoryInput.AskWithHistory("[cyan]Enter the first file path:[/]");
- 
- 		if (!File.Exists(file1))
- 		{
- 			AnsiConsole.MarkupLine("[red]Error: First file does not exist![/]");
- 			return;
- 		}
- 
- 		var file2 = HistoryInput.AskWithHistory("[cyan]Enter the second file path:[/]");
- 
- 		if (!File.Exists(file2))
- 		{
- 			AnsiConsole.MarkupLine("[red]Error: Second file does not exist![/]");
- 			return;
- 		}
- 
- 		CompareTwoFiles(file1, file2);
- 	}
- 
- 	/// <summary>
- 	/// Shows help information
- 	/// </summary>
- 	private static void ShowHelp()
- 	{
- 		var panel = new Panel("""
- 		[bold]DiffMore - File Comparison Tool[/]
- 
- 		[yellow]Features:[/]
- 		• Compare files with the same name across directories
- 		• Compare two directories with file patterns
- 		• Compare two specific files
- 		• [cyan]Iterative merge multiple file versions[/]
- 		• View differences in multiple formats (git-style, change summary)
- 		• Sync files to make them identical
- 
- 		[yellow]Command Line Usage:[/]
- 		DiffMore.CLI <directory> <filename>
- 
- 		[yellow]Interactive Mode:[/]
- 		Run without arguments to use the interactive TUI interface.
- 
- 		[yellow]Iterative Merge:[/]
- 		• Automatically finds the most similar files and merges them step by step
- 		• Interactive conflict resolution with visual TUI
- 		• Optimal merge order based on similarity calculation
- 		• Save final merged result to a new file
- 		""")
- 		{
- 			Header = new PanelHeader("[bold blue]Help[/]"),
- 			Border = BoxBorder.Rounded
- 		};
- 
- 		AnsiConsole.Write(panel);
- 	}
- 
- 	/// <summary>
- 	/// Processes files with the same name in a directory
  	/// </summary>
  	/// <param name="directory">The directory to search</param>
```

```diff
  		}
  	}
+ 
+ 	/// <summary>
+ 	/// Compares two directories interactively
+ 	/// </summary>
+ 	private static void CompareTwoDirectories()
+ 	{
+ 		var dir1 = HistoryInput.AskWithHistory("[cyan]Enter the first directory path:[/]");
+ 
+ 		if (!Directory.Exists(dir1))
+ 		{
+ 			AnsiConsole.MarkupLine("[red]Error: First directory does not exist![/]");
+ 			return;
+ 		}
+ 
+ 		var dir2 = HistoryInput.AskWithHistory("[cyan]Enter the second directory path:[/]");
+ 
+ 		if (!Directory.Exists(dir2))
+ 		{
+ 			AnsiConsole.MarkupLine("[red]Error: Second directory does not exist![/]");
+ 			return;
+ 		}
+ 
+ 		var pattern = HistoryInput.AskWithHistory("[cyan]Enter file pattern (e.g., *.txt, *.cs):[/]", "*.*");
+ 		var recursive = AnsiConsole.Confirm("[cyan]Search subdirectories recursively?[/]", false);
+ 
+ 		CompareDirectories(dir1, dir2, pattern, recursive);
+ 	}
+ 
+ 	/// <summary>
+ 	/// Compares two specific files
+ 	/// </summary>
+ 	private static void CompareTwoSpecificFiles()
+ 	{
+ 		var file1 = HistoryInput.AskWithHistory("[cyan]Enter the first file path:[/]");
+ 
+ 		if (!File.Exists(file1))
+ 		{
+ 			AnsiConsole.MarkupLine("[red]Error: First file does not exist![/]");
+ 			return;
+ 		}
+ 
+ 		var file2 = HistoryInput.AskWithHistory("[cyan]Enter the second file path:[/]");
+ 
+ 		if (!File.Exists(file2))
+ 		{
+ 			AnsiConsole.MarkupLine("[red]Error: Second file does not exist![/]");
+ 			return;
+ 		}
+ 
+ 		CompareTwoFiles(file1, file2);
+ 	}
+ 
+ 	/// <summary>
+ 	/// Shows help information
+ 	/// </summary>
+ 	private static void ShowHelp()
+ 	{
+ 		var panel = new Panel("""
+ 		[bold]DiffMore - File Comparison Tool[/]
+ 
+ 		[yellow]Features:[/]
+ 		• Compare files with the same name across directories
+ 		• Compare two directories with file patterns
+ 		• Compare two specific files
+ 		• [cyan]Iterative merge multiple file versions[/]
+ 		• View differences in multiple formats (git-style, change summary)
+ 		• Sync files to make them identical
+ 
+ 		[yellow]Command Line Usage:[/]
+ 		DiffMore.CLI <directory> <filename>
+ 
+ 		[yellow]Interactive Mode:[/]
+ 		Run without arguments to use the interactive TUI interface.
+ 
+ 		[yellow]Iterative Merge:[/]
+ 		• Automatically finds the most similar files and merges them step by step
+ 		• Interactive conflict resolution with visual TUI
+ 		• Optimal merge order based on similarity calculation
+ 		• Save final merged result to a new file
+ 		""")
+ 		{
+ 			Header = new PanelHeader("[bold blue]Help[/]"),
+ 			Border = BoxBorder.Rounded
+ 		};
+ 
+ 		AnsiConsole.Write(panel);
+ 	}
  
  	/// <summary>
```

---

That went a bit wrong. Let me see what happened by checking the current state around where the method should be:

---

Read file: DiffMore.ConsoleApp/Program.cs

---

Let me continue checking to see if there are missing methods:

---

<details>
            <summary>Grep search for "static void CompareTwoDirectories" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L522 | `private static void CompareTwoDirectories()` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L522 | `private static void CompareTwoDirectories()` |

</details>

---

Let me check if there are missing methods that should be restored:

---

<details>
            <summary>Grep search for "CompareFilesInDirectory" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L97 | `CompareFilesInDirectory();` |
| `file:///c%3A/dev/ktsu-dev/DiffMore/DiffMore.ConsoleApp/Program.cs` | L97 | `CompareFilesInDirectory();` |

</details>

---

It seems a method is missing. Let me check where `CompareFilesInDirectory()` is called and add the missing method:

---

Read file: DiffMore.ConsoleApp/Program.cs

---

I need to add the missing `CompareFilesInDirectory` method. Let me add it right after the `ProcessFiles` method:

---

```diff
  			});
  	}
+ 
+ 	/// <summary>
+ 	/// Compares files with the same name in a directory
+ 	/// </summary>
+ 	private static void CompareFilesInDirectory()
+ 	{
+ 		var directory = HistoryInput.AskWithHistory("[cyan]Enter the directory path:[/]");
+ 
+ 		if (!Directory.Exists(directory))
+ 		{
+ 			AnsiConsole.MarkupLine("[red]Error: Directory does not exist![/]");
+ 			return;
+ 		}
+ 
+ 		var fileName = HistoryInput.AskWithHistory("[cyan]Enter the filename to search for:[/]");
+ 
+ 		ProcessFiles(directory, fileName);
+ 	}
  
  	/// <summary>
```

---

Now let me try building again to see if all the errors are resolved:

---

```bash
dotnet build
```

```
 PS C:\dev\ktsu-dev\DiffMore >dotnet build

  C:\dev\ktsu-dev\DiffMore\DiffMore.sln                                    Restore (0.0s) 
Restore complete (0.6s)
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 1 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 2 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file i
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 3 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file i
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 4 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file i
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 5 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file i
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 6 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file i
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 7 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file i
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 8 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file i
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 9 in 1000m
s. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file i
s locked by: "ktsu.DiffMore.ConsoleApp (15312)"
C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): warni
ng MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu.D
iffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 10 in 1000
ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\D
ebug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The file
is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
  DiffMore.ConsoleApp failed with 2 error(s) and 10 warning(s) (13.3s)
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 1 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 2 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 3 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 4 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 5 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 6 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 7 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 8 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 9 in 1
000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bi
n\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The fi
le is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): w
arning MSB3026: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\kt
su.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Beginning retry 10 in
1000ms. The process cannot access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\b
in\Debug\net9.0\ktsu.DiffMore.Core.dll' because it is being used by another process. The f
ile is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): e
rror MSB3027: Could not copy "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0\ktsu
.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". Exceeded retry count of
10. Failed. The file is locked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5094,5): e
rror MSB3021: Unable to copy file "C:\dev\ktsu-dev\DiffMore\DiffMore.Core\bin\Debug\net9.0
\ktsu.DiffMore.Core.dll" to "bin\Debug\net9.0\ktsu.DiffMore.Core.dll". The process cannot
access the file 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\Debug\net9.0\ktsu.DiffMo
re.Core.dll' because it is being used by another process.

Build failed with 2 error(s) and 10 warning(s) in 14.7s
  09:32:20   DiffMore  14.922s   1 - ERROR 
  19:32:20 main  ?1 ~1

```

---

It looks like there's a running instance of the application locking the DLL files. Let me try stopping any running processes and then cleaning and rebuilding:

---

```bash
dotnet clean
```

```
 PS C:\dev\ktsu-dev\DiffMore >dotnet clean

  DiffMore.Core                                                          CoreClean (0.0s)
  DiffMore.ConsoleApp                                                    CoreClean (0.0s) 
                                                                                   (0.1s) 
  DiffMore.ConsoleApp succeeded with 5 warning(s) (1.6s)
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5933,5): w
arning MSB3061: Unable to delete file "C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.ConsoleApp.exe". Access to the path 'C:\dev\ktsu-dev\DiffMore\Dif
fMore.ConsoleApp\bin\Debug\net9.0\ktsu.DiffMore.ConsoleApp.exe' is denied. The file is loc
ked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5933,5): w
arning MSB3061: Unable to delete file "C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.ConsoleApp.dll". Access to the path 'C:\dev\ktsu-dev\DiffMore\Dif
fMore.ConsoleApp\bin\Debug\net9.0\ktsu.DiffMore.ConsoleApp.dll' is denied. The file is loc
ked by: "ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5933,5): w
arning MSB3061: Unable to delete file "C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\Spectre.Console.dll". Access to the path 'C:\dev\ktsu-dev\DiffMore\DiffMore.Con
soleApp\bin\Debug\net9.0\Spectre.Console.dll' is denied. The file is locked by: "Microsoft
 Visual Studio 2022 (60380), ktsu.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5933,5): w
arning MSB3061: Unable to delete file "C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\ktsu.DiffMore.Core.dll". Access to the path 'C:\dev\ktsu-dev\DiffMore\DiffMore.
ConsoleApp\bin\Debug\net9.0\ktsu.DiffMore.Core.dll' is denied. The file is locked by: "kts
u.DiffMore.ConsoleApp (15312)"
    C:\Program Files\dotnet\sdk\9.0.300\Microsoft.Common.CurrentVersion.targets(5933,5): w
arning MSB3061: Unable to delete file "C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\bin\De
bug\net9.0\DiffPlex.dll". Access to the path 'C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp
\bin\Debug\net9.0\DiffPlex.dll' is denied. The file is locked by: "ktsu.DiffMore.ConsoleAp
p (15312)"

Build succeeded with 5 warning(s) in 1.9s
  09:32:28   DiffMore  2.209s  
  19:32:28 main  ?1 ~1 
 PS C:\dev\ktsu-dev\DiffMore >
```

---

There's still a running process (PID 15312) that's locking the files. Let me try to kill that process and then build:

---

```bash
taskkill /F /PID 15312
```

```
 PS C:\dev\ktsu-dev\DiffMore >taskkill /F /PID 15312
SUCCESS: The process with PID 15312 has been terminated.
  09:33:55   DiffMore  409ms  
  19:33:55 main  ?1 ~1
 PS C:\dev\ktsu-dev\DiffMore >
```

---

Good! Now let me try building again:

---

```bash
dotnet build
```

```
 PS C:\dev\ktsu-dev\DiffMore >dotnet build

  C:\dev\ktsu-dev\DiffMore\DiffMore.sln                                    Restore (0.0s)
                                                                                   (0.1s) 
Restore complete (0.7s)
  DiffMore.Core succeeded (0.4s) → DiffMore.Core\bin\Debug\net9.0\ktsu.DiffMore.Core.dll

  DiffMore.ConsoleApp succeeded (0.3s) → DiffMore.ConsoleApp\bin\Debug\net9.0\ktsu.DiffMor
e.ConsoleApp.dll
  DiffMore.Test succeeded (0.6s) → DiffMore.Test\bin\Debug\net9.0\ktsu.DiffMore.Test.dll


Build succeeded in 2.3s
  09:34:02   DiffMore  2.566s  
  19:34:02 main  ?1 ~1 

```

---



Excellent! The build is now successful. Let me run the tests to make sure everything is working correctly:

---

```bash
dotnet test
```

```
 PS C:\dev\ktsu-dev\DiffMore >dotnet test

Restore complete (0.7s)
  DiffMore.Core succeeded (0.2s) → DiffMore.Core\bin\Debug\net9.0\ktsu.DiffMore.Core.dll

  DiffMore.ConsoleApp succeeded (0.0s) → DiffMore.ConsoleApp\bin\Debug\net9.0\ktsu.DiffMor
e.ConsoleApp.dll
  DiffMore.Test succeeded (0.1s) → DiffMore.Test\bin\Debug\net9.0\ktsu.DiffMore.Test.dll
  DiffMore.Test test failed with 21 error(s) (2.1s)
    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\EdgeCaseTests.cs(51): error test failed:

      FileDiffer_EmptyFiles_ProducesCorrectDiff (21ms): Assert.AreEqual failed. Expected:<
      >. Actual:<--- C:\Users\MatthewEdmondson\AppData\Local\Temp\DiffMoreTests_EdgeCases\
      empty1.txt
      +++ C:\Users\MatthewEdmondson\AppData\Local\Temp\DiffMoreTests_EdgeCases\empty2.txt>
      . Git diff for empty files should be empty string
      Stack Trace:
         at ktsu.DiffMore.Test.EdgeCaseTests.FileDiffer_EmptyFiles_ProducesCorrectDiff() i
      n C:\dev\ktsu-dev\DiffMore\DiffMore.Test\EdgeCaseTests.cs:line 51
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\EdgeCaseTests.cs(95): error test failed:

      FileDiffer_VeryLargeFile_HandlesCorrectly (18ms): Assert.AreEqual failed. Expected:<
      1>. Actual:<2>. Should find the one modified line
      Stack Trace:
         at ktsu.DiffMore.Test.EdgeCaseTests.FileDiffer_VeryLargeFile_HandlesCorrectly() i
      n C:\dev\ktsu-dev\DiffMore\DiffMore.Test\EdgeCaseTests.cs:line 95
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\EdgeCaseTests.cs(148): error test failed:

      FileDiffer_AllLinesChangedFile_ShowsCompleteChanges (3ms): Assert.AreEqual failed. E
      xpected:<3>. Actual:<0>. Should find all 3 lines modified
      Stack Trace:
         at ktsu.DiffMore.Test.EdgeCaseTests.FileDiffer_AllLinesChangedFile_ShowsCompleteC
      hanges() in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\EdgeCaseTests.cs:line 148

         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferDiffTests.cs(113): error test failed:

      FindDifferences_ModifiedLine_ReturnsCorrectDifference (3ms): Assert.IsNotNull failed
      . Should find difference at line 2
      Stack Trace:
         at ktsu.DiffMore.Test.FileDifferDiffTests.FindDifferences_ModifiedLine_ReturnsCor
      rectDifference() in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferDiffTests.cs:li
      ne 113
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferDiffTests.cs(135): error test failed:

      FindDifferences_DeletedLine_ReturnsCorrectDifference (3ms): Assert.IsNotNull failed.
       Should find deleted line (Line 2)
      Stack Trace:
         at ktsu.DiffMore.Test.FileDifferDiffTests.FindDifferences_DeletedLine_ReturnsCorr
      ectDifference() in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferDiffTests.cs:lin
      e 135
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferDiffTests.cs(151): error test failed:

      GenerateGitStyleDiff_IdenticalFiles_ReturnsEmptyString (4ms): Assert.AreEqual failed
      . Expected:<>. Actual:<--- C:\Users\MatthewEdmondson\AppData\Local\Temp\DiffMoreTest
      s_Diff\file1.txt
      +++ C:\Users\MatthewEdmondson\AppData\Local\Temp\DiffMoreTests_Diff\identical.txt>. 
      Git style diff should be empty for identical files
      Stack Trace:
         at ktsu.DiffMore.Test.FileDifferDiffTests.GenerateGitStyleDiff_IdenticalFiles_Ret
      urnsEmptyString() in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferDiffTests.cs:l
      ine 151
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferDiffTests.cs(221): error test failed:

      GenerateChangeSummaryDiff_WithDifferences_ContainsSummaryInfo (5ms): Assert.IsTrue f
      ailed. Summary should mention modified lines
      Stack Trace:
         at ktsu.DiffMore.Test.FileDifferDiffTests.GenerateChangeSummaryDiff_WithDifferenc
      es_ContainsSummaryInfo() in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferDiffTes
      ts.cs:line 221
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferPathTests.cs(59): error test failed: 
      FileDiffer_InvalidPaths_ThrowsDirectoryNotFoundException (9ms): Assert.ThrowsExcepti
      on failed. Expected exception type:<System.IO.DirectoryNotFoundException> but no exc
      eption was thrown.
      Stack Trace:
         at ktsu.DiffMore.Test.FileDifferPathTests.FileDiffer_InvalidPaths_ThrowsDirectory
      NotFoundException() in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferPathTests.cs
      :line 59
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferPathTests.cs(168): error test failed:

      FileDiffer_MultipleSearchPatterns_FindsAllMatchingFiles (6ms): Assert.AreEqual faile
      d. Expected:<2>. Actual:<0>. Should have 2 same files (*.txt and *.md)
      Stack Trace:
         at ktsu.DiffMore.Test.FileDifferPathTests.FileDiffer_MultipleSearchPatterns_Finds
      AllMatchingFiles() in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileDifferPathTests.cs:
      line 168
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileFinderTests.cs(51): error test failed:

      FindFiles_ExistingFileName_ReturnsAllMatches (25ms): Assert.IsTrue failed. Root file
       should be found
      Stack Trace:
         at ktsu.DiffMore.Test.FileFinderTests.FindFiles_ExistingFileName_ReturnsAllMatche
      s() in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileFinderTests.cs:line 51
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileFinderTests.cs(75): error test failed:

      FindFiles_UniqueFileName_ReturnsSingleFile (0ms): Assert.AreEqual failed. Expected:<
      /mock-test-dir\Subdir1\different.txt>. Actual:<C:\mock-test-dir\Subdir1\different.tx
      t>. Should find the correct file
      Stack Trace:
         at ktsu.DiffMore.Test.FileFinderTests.FindFiles_UniqueFileName_ReturnsSingleFile(
      ) in C:\dev\ktsu-dev\DiffMore\DiffMore.Test\FileFinderTests.cs:line 75
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    /_/src/Spectre.Console/Internal/DefaultExclusivityMode.cs(35): error test failed:

      Main_WithValidArgs_FindsFilesAndGroups (107ms): Test method ktsu.DiffMore.Test.Progr
      amTests.Main_WithValidArgs_FindsFilesAndGroups threw exception:
      System.InvalidOperationException: Trying to run one or more interactive functions co
      ncurrently. Operations with dynamic displays (e.g. a prompt and a progress display) 
      cannot be running at the same time.
      Stack Trace:
         at Spectre.Console.Internal.DefaultExclusivityMode.RunAsync[T](Func`1 func) in /_
      /src/Spectre.Console/Internal/DefaultExclusivityMode.cs:line 35
         at Spectre.Console.TextPrompt`1.ShowAsync(IAnsiConsole console, CancellationToken
       cancellationToken) in /_/src/Spectre.Console/Prompts/TextPrompt.cs:line 122

         at Spectre.Console.ConfirmationPrompt.ShowAsync(IAnsiConsole console, Cancellatio
      nToken cancellationToken) in /_/src/Spectre.Console/Prompts/ConfirmationPrompt.cs:li
      ne 92
         at Spectre.Console.ConfirmationPrompt.Show(IAnsiConsole console) in /_/src/Spectr
      e.Console/Prompts/ConfirmationPrompt.cs:line 73
         at Spectre.Console.AnsiConsole.Confirm(String prompt, Boolean defaultValue) in /_
      /src/Spectre.Console/AnsiConsole.Prompt.cs:line 103
         at ktsu.DiffMore.CLI.Program.ShowDifferences(List`1 fileGroups) in C:\dev\ktsu-de
      v\DiffMore\DiffMore.ConsoleApp\Program.cs:line 234
         at ktsu.DiffMore.CLI.Program.<>c__DisplayClass3_0.<ProcessFiles>b__0(StatusContex
      t ctx) in C:\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs:line 167
         at Spectre.Console.Status.<>c__DisplayClass14_0.<Start>b__0(StatusContext ctx) in
       /_/src/Spectre.Console/Live/Status/Status.cs:line 44
         at Spectre.Console.Status.<>c__DisplayClass16_0.<<StartAsync>b__0>d.MoveNext() in
       /_/src/Spectre.Console/Live/Status/Status.cs:line 79
      --- End of stack trace from previous location ---
         at Spectre.Console.Status.<>c__DisplayClass17_0`1.<<StartAsync>b__0>d.MoveNext() 
      in /_/src/Spectre.Console/Live/Status/Status.cs:line 120
      --- End of stack trace from previous location ---
         at Spectre.Console.Progress.<>c__DisplayClass32_0`1.<<StartAsync>b__0>d.MoveNext(
      ) in /_/src/Spectre.Console/Live/Progress/Progress.cs:line 138
      --- End of stack trace from previous location ---
         at Spectre.Console.Internal.DefaultExclusivityMode.RunAsync[T](Func`1 func) in /_
      /src/Spectre.Console/Internal/DefaultExclusivityMode.cs:line 40
         at Spectre.Console.Progress.StartAsync[T](Func`2 action) in /_/src/Spectre.Consol
      e/Live/Progress/Progress.cs:line 121
         at Spectre.Console.Status.StartAsync[T](String status, Func`2 func) in /_/src/Spe
      ctre.Console/Live/Status/Status.cs:line 117
         at Spectre.Console.Status.StartAsync(String status, Func`2 action) in /_/src/Spec
      tre.Console/Live/Status/Status.cs:line 77
         at Spectre.Console.Status.Start(String status, Action`1 action) in /_/src/Spectre
      .Console/Live/Status/Status.cs:line 48
         at ktsu.DiffMore.CLI.Program.ProcessFiles(String directory, String fileName) in C
      :\dev\ktsu-dev\DiffMore\DiffMore.ConsoleApp\Program.cs:line 137
         at ktsu.DiffMore.CLI.Program.Main(String[] args) in C:\dev\ktsu-dev\DiffMore\Diff
      More.ConsoleApp\Program.cs:line 42
         at ktsu.DiffMore.Test.ProgramTests.Main_WithValidArgs_FindsFilesAndGroups() in C:
      \dev\ktsu-dev\DiffMore\DiffMore.Test\ProgramTests.cs:line 92
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    /_/src/Spectre.Console/Internal/Backends/Legacy/LegacyConsoleBackend.cs(45): error tes
t failed:
      Main_WithNoFiles_PrintsNoFilesFound (5ms): Test method ktsu.DiffMore.Test.ProgramTes
      ts.Main_WithNoFiles_PrintsNoFilesFound threw exception:
      System.ObjectDisposedException: Cannot write to a closed TextWriter.
      Stack Trace:
         at System.IO.StringWriter.Write(String value)
         at System.IO.TextWriter.SyncTextWriter.Write(String value)
         at Spectre.Console.LegacyConsoleBackend.Write(IRenderable renderable) in /_/src/S
      pectre.Console/Internal/Backends/Legacy/LegacyConsoleBackend.cs:line 45
         at Spectre.Console.AnsiConsoleFacade.Write(IRenderable renderable) in /_/src/Spec
      tre.Console/Internal/Backends/AnsiConsoleFacade.cs:line 40
         at Spectre.Console.AnsiConsole.Write(IRenderable renderable) in /_/src/Spectre.Co
      nsole/AnsiConsole.Rendering.cs:line 29
         at ktsu.DiffMore.CLI.Program.ShowBanner() in C:\dev\ktsu-dev\DiffMore\DiffMore.Co
      nsoleApp\Program.cs:line 73
         at ktsu.DiffMore.CLI.Program.Main(String[] args) in C:\dev\ktsu-dev\DiffMore\Diff
      More.ConsoleApp\Program.cs:line 32
         at ktsu.DiffMore.Test.ProgramTests.Main_WithNoFiles_PrintsNoFilesFound() in C:\de
      v\ktsu-dev\DiffMore\DiffMore.Test\ProgramTests.cs:line 107
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    /_/src/Spectre.Console/Internal/Backends/Legacy/LegacyConsoleBackend.cs(45): error tes
t failed:
      Main_WithNonExistentDirectory_PrintsError (4ms): Test method ktsu.DiffMore.Test.Prog
      ramTests.Main_WithNonExistentDirectory_PrintsError threw exception:
      System.ObjectDisposedException: Cannot write to a closed TextWriter.
      Stack Trace:
         at System.IO.StringWriter.Write(String value)
         at System.IO.TextWriter.SyncTextWriter.Write(String value)
         at Spectre.Console.LegacyConsoleBackend.Write(IRenderable renderable) in /_/src/S
      pectre.Console/Internal/Backends/Legacy/LegacyConsoleBackend.cs:line 45
         at Spectre.Console.AnsiConsoleFacade.Write(IRenderable renderable) in /_/src/Spec
      tre.Console/Internal/Backends/AnsiConsoleFacade.cs:line 40
         at Spectre.Console.AnsiConsole.Write(IRenderable renderable) in /_/src/Spectre.Co
      nsole/AnsiConsole.Rendering.cs:line 29
         at ktsu.DiffMore.CLI.Program.ShowBanner() in C:\dev\ktsu-dev\DiffMore\DiffMore.Co
      nsoleApp\Program.cs:line 73
         at ktsu.DiffMore.CLI.Program.Main(String[] args) in C:\dev\ktsu-dev\DiffMore\Diff
      More.ConsoleApp\Program.cs:line 32
         at ktsu.DiffMore.Test.ProgramTests.Main_WithNonExistentDirectory_PrintsError() in
       C:\dev\ktsu-dev\DiffMore\DiffMore.Test\ProgramTests.cs:line 123
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signa
      ture sig, Boolean isConstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags 
      invokeAttr)


    /_/src/Spectre.Console/Internal/Backends/Legacy/LegacyConsoleBackend.cs(45): error tes
t failed:
      Main_WithInsufficientArgs_PrintsUsage (3ms): Test method ktsu.DiffMore.Test.ProgramT
      ests.Main_WithInsufficientArgs_PrintsUsage threw exception:
      System.ObjectDisposedException: Cannot write to a closed TextWriter.
      Stack Trace:
         at System.IO.StringWriter.Write(String value)
         at System.IO.TextWriter.SyncTextWriter.Write(String value)
         at Spectre.Console.LegacyConsoleBackend.Write(IRenderable renderable) in /_/src/S
      pectre.Console/Internal/Backends/Legacy/LegacyConsoleBackend.cs:line 45
         at Spectre.Console.AnsiConsoleFacade.Write(IRenderable renderable) in /_/src/Spec
    C:\dev\ktsu-dev\DiffMore\DiffMore.Test\bin\Debug\net9.0\ktsu.DiffMore.Test.dll : error
 run failed: Tests failed: 'C:\dev\ktsu-dev\DiffMore\DiffMore.Test\bin\Debug\net9.0\TestRe
sults\ktsu.DiffMore.Test_net9.0_x64.log' [net9.0|x64]

Test summary: total: 72, failed: 20, succeeded: 52, skipped: 0, duration: 1.4s
Build failed with 21 error(s) in 3.5s
  09:34:16   DiffMore  3.752s   1 - ERROR 
  19:34:16 main  ?1 ~1 

```

---

I can see there are still some issues. The main problem is that there's still a Spectre.Console concurrency issue in

---

