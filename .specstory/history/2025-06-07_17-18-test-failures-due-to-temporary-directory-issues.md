<!-- Generated by SpecStory -->

# Test failures due to temporary directory issues (2025-06-08 03:18:39)

_**User**_

Restore complete (0.6s)
  BlastMerge.Core succeeded (0.5s) → BlastMerge.Core\bin\Debug\net9.0\ktsu.BlastMerge.Core.dll
  BlastMerge.ConsoleApp succeeded (0.5s) → BlastMerge.ConsoleApp\bin\Debug\net9.0\ktsu.BlastMerge.ConsoleApp.dll
  BlastMerge.Test succeeded (0.6s) → BlastMerge.Test\bin\Debug\net9.0\ktsu.BlastMerge.Test.dll
  BlastMerge.Test test failed with 33 error(s) (3.7s)
    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      SaveBatch_ValidBatch_SavesSuccessfully (265ms): Initialization method ktsu.BlastMerge.Test.AppDataBatchMan
      agerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary directory afte
      r 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      GetBatch_ExistingBatch_ReturnsCorrectBatch (76ms): Initialization method ktsu.BlastMerge.Test.AppDataBatch
      ManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary directory a
      fter 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      GetBatch_NonExistentBatch_ReturnsNull (88ms): Initialization method ktsu.BlastMerge.Test.AppDataBatchManag
      erTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary directory after
      100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      ListBatches_NoBatches_ReturnsEmptyCollection (92ms): Initialization method ktsu.BlastMerge.Test.AppDataBat
      chManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary directory
       after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      ListBatches_MultipleBatches_ReturnsAllBatchNames (98ms): Initialization method ktsu.BlastMerge.Test.AppDat
      aBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary direc
      tory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      GetAllBatches_MultipleBatches_ReturnsAllBatches (71ms): Initialization method ktsu.BlastMerge.Test.AppData
      BatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary direct
      ory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      DeleteBatch_ExistingBatch_DeletesSuccessfully (86ms): Initialization method ktsu.BlastMerge.Test.AppDataBa
      tchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary director
      y after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      DeleteBatch_NonExistentBatch_ReturnsFalse (168ms): Initialization method ktsu.BlastMerge.Test.AppDataBatch
      ManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary directory a
      fter 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      SaveBatch_NullBatch_ThrowsArgumentNullException (102ms): Initialization method ktsu.BlastMerge.Test.AppDat
      aBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary direc
      tory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      SaveBatch_EmptyBatchName_ThrowsArgumentException (92ms): Initialization method ktsu.BlastMerge.Test.AppDat
      aBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary direc
      tory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      GetBatch_EmptyBatchName_ThrowsArgumentException (100ms): Initialization method ktsu.BlastMerge.Test.AppDat
      aBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary direc
      tory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      LoadBatch_NullBatchName_ThrowsArgumentNullException (93ms): Initialization method ktsu.BlastMerge.Test.App
      DataBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary di
      rectory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      DeleteBatch_EmptyBatchName_ThrowsArgumentException (94ms): Initialization method ktsu.BlastMerge.Test.AppD
      ataBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary dir
      ectory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      DeleteBatch_NullBatchName_ThrowsArgumentNullException (95ms): Initialization method ktsu.BlastMerge.Test.A
      ppDataBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary
      directory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      SaveBatch_UpdateExistingBatch_UpdatesSuccessfully (87ms): Initialization method ktsu.BlastMerge.Test.AppDa
      taBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary dire
      ctory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      SaveBatch_ComplexBatch_SavesAndRetrievesCorrectly (192ms): Initialization method ktsu.BlastMerge.Test.AppD
      ataBatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary dir
      ectory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      GetAllBatches_NoBatches_ReturnsEmptyCollection (100ms): Initialization method ktsu.BlastMerge.Test.AppData
      BatchManagerTests.Setup threw exception. System.IO.IOException: Unable to create a unique temporary direct
      ory after 100 attempts..
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.AppDataBatchManagerTests.Setup() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\
      AppDataBatchManagerTests.cs:line 27
         at InvokeStub_AppDataBatchManagerTests.Setup(Object, Object, IntPtr*)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs(34): error test failed:
      CreateCustomBatch_WithValidParameters_ReturnsCorrectBatch (17ms): Assert.IsFalse failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.BatchProcessorTests.CreateCustomBatch_WithValidParameters_ReturnsCorrectBatch()
       in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs:line 34
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs(132): error test failed:
      ProcessBatch_WithValidDirectory_ProcessesPatterns (2ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.BatchProcessorTests.ProcessBatch_WithValidDirectory_ProcessesPatterns() in C:\d
      ev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs:line 132
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs(163): error test failed:
      ProcessBatch_WithNoMatchingFiles_HandlesEmptyPattern (1ms): Assert.AreEqual failed. Expected:<1>. Actual:<
      0>.
      Stack Trace:
         at ktsu.BlastMerge.Test.BatchProcessorTests.ProcessBatch_WithNoMatchingFiles_HandlesEmptyPattern() in C
      :\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs:line 163
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs(190): error test failed:
      ProcessBatch_WithSkipEmptyPatterns_SkipsEmptyPatterns (0ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.BatchProcessorTests.ProcessBatch_WithSkipEmptyPatterns_SkipsEmptyPatterns() in
      C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs:line 190
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs(219): error test failed:
      ProcessSinglePattern_WithMultipleFiles_ProcessesMerge (3ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.BatchProcessorTests.ProcessSinglePattern_WithMultipleFiles_ProcessesMerge() in
      C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs:line 219
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs(241): error test failed:
      ProcessSinglePattern_WithSingleFile_ReturnsOnlyOneFileMessage (1ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.BatchProcessorTests.ProcessSinglePattern_WithSingleFile_ReturnsOnlyOneFileMessa
      ge() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs:line 241
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs(297): error test failed:
      ProcessBatchWithDiscretePhases_WithValidData_ProcessesSuccessfully (1ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.BatchProcessorTests.ProcessBatchWithDiscretePhases_WithValidData_ProcessesSucce
      ssfully() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs:line 297
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs(353): error test failed:
      ProcessSinglePatternWithPaths_WithSearchPaths_FindsFilesInSpecifiedPaths (0ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.BatchProcessorTests.ProcessSinglePatternWithPaths_WithSearchPaths_FindsFilesInS
      pecifiedPaths() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\BatchProcessorTests.cs:line 353
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\CharacterLevelDifferTests.cs(42): error test failed:
      CreateCharacterLevelDiff_WithIdenticalText_ReturnsUnchangedText (2ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.CharacterLevelDifferTests.CreateCharacterLevelDiff_WithIdenticalText_ReturnsUnc
      hangedText() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\CharacterLevelDifferTests.cs:line 42
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\CharacterLevelDifferTests.cs(136): error test failed:
      CreateInlineCharacterDiff_WithDifferentLines_ReturnsFormattedDiff (0ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.CharacterLevelDifferTests.CreateInlineCharacterDiff_WithDifferentLines_ReturnsF
      ormattedDiff() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\CharacterLevelDifferTests.cs:line 136
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\CharacterLevelDifferTests.cs(259): error test failed:
      CreateSideBySideCharacterDiff_WithDifferentLines_ReturnsFormattedSides (0ms): Assert.IsTrue failed.
      Stack Trace:
         at ktsu.BlastMerge.Test.CharacterLevelDifferTests.CreateSideBySideCharacterDiff_WithDifferentLines_Retu
      rnsFormattedSides() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\CharacterLevelDifferTests.cs:line 259
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      CreateTempDirectory_CreatesUniqueDirectory (65ms): Test method ktsu.BlastMerge.Test.SecureTempFileHelperTe
      sts.CreateTempDirectory_CreatesUniqueDirectory threw exception:
      System.IO.IOException: Unable to create a unique temporary directory after 100 attempts.
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.SecureTempFileHelperTests.CreateTempDirectory_CreatesUniqueDirectory() in C:\de
      v\ktsu-dev\BlastMerge\BlastMerge.Test\SecureTempFileHelperTests.cs:line 84
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      CreateTempDirectory_MultipleCallsCreateUniqueDirectories (80ms): Test method ktsu.BlastMerge.Test.SecureTe
      mpFileHelperTests.CreateTempDirectory_MultipleCallsCreateUniqueDirectories threw exception:
      System.IO.IOException: Unable to create a unique temporary directory after 100 attempts.
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.SecureTempFileHelperTests.CreateTempDirectory_MultipleCallsCreateUniqueDirector
      ies() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\SecureTempFileHelperTests.cs:line 103
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      SafeDeleteTempDirectory_DeletesExistingDirectory (95ms): Test method ktsu.BlastMerge.Test.SecureTempFileHe
      lperTests.SafeDeleteTempDirectory_DeletesExistingDirectory threw exception:
      System.IO.IOException: Unable to create a unique temporary directory after 100 attempts.
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.SecureTempFileHelperTests.SafeDeleteTempDirectory_DeletesExistingDirectory() in
       C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\SecureTempFileHelperTests.cs:line 187
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Core\Services\SecureTempFileHelper.cs(165): error test failed:
      SafeDeleteTempDirectory_WithFilesInside_DeletesRecursively (103ms): Test method ktsu.BlastMerge.Test.Secur
      eTempFileHelperTests.SafeDeleteTempDirectory_WithFilesInside_DeletesRecursively threw exception:
      System.IO.IOException: Unable to create a unique temporary directory after 100 attempts.
      Stack Trace:
         at ktsu.BlastMerge.Core.Services.SecureTempFileHelper.CreateTempDirectory() in C:\dev\ktsu-dev\BlastMer
      ge\BlastMerge.Core\Services\SecureTempFileHelper.cs:line 165
         at ktsu.BlastMerge.Test.SecureTempFileHelperTests.SafeDeleteTempDirectory_WithFilesInside_DeletesRecurs
      ively() in C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\SecureTempFileHelperTests.cs:line 201
         at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isCo
      nstructor)
         at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)


    C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\bin\Debug\net9.0\ktsu.BlastMerge.Test.dll : error run failed: Tests failed: 'C:\dev\ktsu-dev\BlastMerge\BlastMerge.Test\bin\Debug\net9.0\TestResults\ktsu.BlastMerge.Test_net9.0_x64.log' [net9.0|x64]

Test summary: total: 213, failed: 32, succeeded: 181, skipped: 0, duration: 3.3s
Build failed with 33 error(s) in 6.1s
  17:18:15   BlastMerge  19.493s   1 - ERROR 
  03:18:15 batching  +10 ~1
 PS C:\dev\ktsu-dev\BlastMerge >

---

_**Assistant**_



---

I can see that there are 33 test failures, with the main issue being that the `SecureTempFileHelper.CreateTempDirectory()` method is failing to create unique temporary directories after 100 attempts. This is causing cascading failures in many tests.

Let me examine the `SecureTempFileHelper.cs` file to understand what's happening:

---

Read file: BlastMerge.Core/Services/SecureTempFileHelper.cs

---

Now let me look at the `GetSecureTempPath()` method to understand how the temporary path is determined:

---

Read file: BlastMerge.Core/Services/SecureTempFileHelper.cs

---

Now let me check if there are any test cleanup issues by looking at the failing test setup:

---

Read file: BlastMerge.Test/AppDataBatchManagerTests.cs

---

I see the issue. The problem is likely that the tests are running concurrently or in quick succession, and the `CreateTempDirectory()` method is having collisions when trying to create directories. The issue is in the algorithm - when `Directory.CreateDirectory(fullPath)` is called, it doesn't fail if the directory already exists, which means we can't rely on it to detect collisions. The current logic creates the directory first, then tries to create a marker file, but this has a race condition.

Let me also check the current temp directory state:

---

```bash
dir "%TEMP%" /A:D | findstr /i blastmerge
```

```
C:\dev\ktsu-dev\BlastMerge>dir "%TEMP%" /A:D | findstr /i blastmerge
Microsoft Windows [Version 10.0.26100.4061]
(c) Microsoft Corporation. All rights reserved.

C:\dev\ktsu-dev\BlastMerge>dir "%TEMP%" /A:D | findstr /i blastmerge
























C:\dev\ktsu-dev\BlastMerge>
```

---

Let me check if there are any leftover temp directories:

---

```bash
dir "%TEMP%" | find /c /i "."
```

```
C:\dev\ktsu-dev\BlastMerge>dir "%TEMP%" | find /c /i "."

C:\dev\ktsu-dev\BlastMerge>
```

---

Let me check the temp directory more directly:

---

```bash
powershell "Get-ChildItem $env:TEMP | Measure-Object | Select-Object Count"
```

```
C:\dev\ktsu-dev\BlastMerge>powershell "Get-ChildItem $env:TEMP | Measure-Object | Select-Object Count"

Count
-----
22590


C:\dev\ktsu-dev\BlastMerge>
```

---

There are 22,590 items in the temp directory! This is likely why the random file creation is failing - the temp directory is extremely cluttered. This creates two issues:

1. The `Path.GetRandomFileName()` generates random names but with so many files already there, collisions become very likely
2. File system performance degrades with this many files in a single directory

The fix is to improve the `CreateTempDirectory()` method to be more robust. Let me fix this:

---



---

